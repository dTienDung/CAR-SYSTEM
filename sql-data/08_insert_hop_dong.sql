-- ============================================
-- FILE: 08_insert_hop_dong.sql
-- MÔ TẢ: Insert dữ liệu cho bảng HOP_DONG
-- LƯU Ý: Cần chạy file 06_insert_ho_so_tham_dinh.sql trước
--        Người tạo hợp đồng: SALES
-- ============================================

-- Xóa dữ liệu cũ (nếu có)
-- DELETE FROM hop_dong;

-- Insert dữ liệu Hợp đồng bảo hiểm
INSERT INTO hop_dong (ma_hd, khach_hang_id, xe_id, ho_so_tham_dinh_id, goi_bao_hiem_id, ngay_ky, ngay_hieu_luc, ngay_het_han, tong_phi_bao_hiem, tong_da_thanh_toan, trang_thai, ghi_chu, nguoi_tao_id, hop_dong_cu_id, loai_quan_he, created_at, updated_at) VALUES
-- Hợp đồng đang hoạt động (tất cả được tạo bởi SALES)
('HD-20231201-0001',
 (SELECT id FROM khach_hang WHERE makh = 'KH000001'),
 (SELECT id FROM xe WHERE ma_xe = 'XE000001'),
 (SELECT id FROM ho_so_tham_dinh WHERE mahs = 'HS-20231201-0001'),
 (SELECT id FROM goi_bao_hiem WHERE ma_goi = 'GOI002'),
 '2023-12-01', '2023-12-05', '2024-12-04', 5000000.00, 5000000.00,
 'ACTIVE', 'Hợp đồng đã thanh toán đủ, đang hiệu lực',
 (SELECT id FROM users WHERE username = 'sales'),
 NULL, NULL,
 '2023-12-01 16:00:00', '2023-12-05 10:00:00'),

('HD-20231202-0002',
 (SELECT id FROM khach_hang WHERE makh = 'KH000002'),
 (SELECT id FROM xe WHERE ma_xe = 'XE000002'),
 (SELECT id FROM ho_so_tham_dinh WHERE mahs = 'HS-20231202-0002'),
 (SELECT id FROM goi_bao_hiem WHERE ma_goi = 'GOI001'),
 '2023-12-02', '2023-12-06', '2024-12-05', 3600000.00, 3600000.00,
 'ACTIVE', 'Hợp đồng gói cơ bản',
 (SELECT id FROM users WHERE username = 'sales'),
 NULL, NULL,
 '2023-12-02 17:00:00', '2023-12-06 09:00:00'),

('HD-20231205-0003',
 (SELECT id FROM khach_hang WHERE makh = 'KH000003'),
 (SELECT id FROM xe WHERE ma_xe = 'XE000003'),
 (SELECT id FROM ho_so_tham_dinh WHERE mahs = 'HS-20231205-0003'),
 (SELECT id FROM goi_bao_hiem WHERE ma_goi = 'GOI003'),
 '2023-12-05', '2023-12-10', '2024-12-09', 8000000.00, 8000000.00,
 'ACTIVE', 'Hợp đồng toàn diện xe Mazda CX-5',
 (SELECT id FROM users WHERE username = 'sales'),
 NULL, NULL,
 '2023-12-05 18:00:00', '2023-12-10 14:00:00'),

('HD-20231206-0004',
 (SELECT id FROM khach_hang WHERE makh = 'KH000004'),
 (SELECT id FROM xe WHERE ma_xe = 'XE000004'),
 (SELECT id FROM ho_so_tham_dinh WHERE mahs = 'HS-20231206-0004'),
 (SELECT id FROM goi_bao_hiem WHERE ma_goi = 'GOI002'),
 '2023-12-06', '2023-12-10', '2024-12-09', 6000000.00, 3000000.00,
 'ACTIVE', 'Đã thanh toán một phần, còn nợ 3 triệu',
 (SELECT id FROM users WHERE username = 'sales'),
 NULL, NULL,
 '2023-12-06 15:30:00', '2023-12-10 11:00:00'),

('HD-20231208-0005',
 (SELECT id FROM khach_hang WHERE makh = 'KH000005'),
 (SELECT id FROM xe WHERE ma_xe = 'XE000005'),
 (SELECT id FROM ho_so_tham_dinh WHERE mahs = 'HS-20231208-0005'),
 (SELECT id FROM goi_bao_hiem WHERE ma_goi = 'GOI005'),
 '2023-12-08', '2023-12-12', '2024-12-11', 9000000.00, 9000000.00,
 'ACTIVE', 'Hợp đồng kinh doanh xe Ford Ranger',
 (SELECT id FROM users WHERE username = 'sales'),
 NULL, NULL,
 '2023-12-08 17:15:00', '2023-12-12 10:30:00'),

('HD-20231210-0006',
 (SELECT id FROM khach_hang WHERE makh = 'KH000006'),
 (SELECT id FROM xe WHERE ma_xe = 'XE000006'),
 (SELECT id FROM ho_so_tham_dinh WHERE mahs = 'HS-20231210-0006'),
 (SELECT id FROM goi_bao_hiem WHERE ma_goi = 'GOI001'),
 '2023-12-10', '2023-12-15', '2024-12-14', 3600000.00, 3600000.00,
 'ACTIVE', 'Hợp đồng xe Kia Morning',
 (SELECT id FROM users WHERE username = 'sales'),
 NULL, NULL,
 '2023-12-10 16:00:00', '2023-12-15 09:00:00'),

('HD-20231212-0007',
 (SELECT id FROM khach_hang WHERE makh = 'KH000007'),
 (SELECT id FROM xe WHERE ma_xe = 'XE000007'),
 (SELECT id FROM ho_so_tham_dinh WHERE mahs = 'HS-20231212-0007'),
 (SELECT id FROM goi_bao_hiem WHERE ma_goi = 'GOI004'),
 '2023-12-12', '2023-12-15', '2024-12-14', 15000000.00, 15000000.00,
 'ACTIVE', 'Hợp đồng VIP xe Mercedes C200',
 (SELECT id FROM users WHERE username = 'sales'),
 NULL, NULL,
 '2023-12-12 18:00:00', '2023-12-15 10:00:00'),

('HD-20231213-0008',
 (SELECT id FROM khach_hang WHERE makh = 'KH000007'),
 (SELECT id FROM xe WHERE ma_xe = 'XE000008'),
 (SELECT id FROM ho_so_tham_dinh WHERE mahs = 'HS-20231213-0008'),
 (SELECT id FROM goi_bao_hiem WHERE ma_goi = 'GOI003'),
 '2023-12-13', '2023-12-18', '2024-12-17', 8000000.00, 8000000.00,
 'ACTIVE', 'Hợp đồng xe Fortuner của khách hàng thân thiết',
 (SELECT id FROM users WHERE username = 'sales'),
 NULL, NULL,
 '2023-12-13 17:00:00', '2023-12-18 11:00:00'),

('HD-20231215-0009',
 (SELECT id FROM khach_hang WHERE makh = 'KH000008'),
 (SELECT id FROM xe WHERE ma_xe = 'XE000009'),
 (SELECT id FROM ho_so_tham_dinh WHERE mahs = 'HS-20231215-0009'),
 (SELECT id FROM goi_bao_hiem WHERE ma_goi = 'GOI002'),
 '2023-12-15', '2023-12-20', '2024-12-19', 6000000.00, 6000000.00,
 'ACTIVE', 'Hợp đồng xe Vinfast Fadil',
 (SELECT id FROM users WHERE username = 'sales'),
 NULL, NULL,
 '2023-12-15 15:00:00', '2023-12-20 09:30:00'),

('HD-20231218-0010',
 (SELECT id FROM khach_hang WHERE makh = 'KH000009'),
 (SELECT id FROM xe WHERE ma_xe = 'XE000010'),
 (SELECT id FROM ho_so_tham_dinh WHERE mahs = 'HS-20231218-0010'),
 (SELECT id FROM goi_bao_hiem WHERE ma_goi = 'GOI003'),
 '2023-12-18', '2023-12-22', '2024-12-21', 8000000.00, 8000000.00,
 'ACTIVE', 'Hợp đồng xe Honda CR-V',
 (SELECT id FROM users WHERE username = 'sales'),
 NULL, NULL,
 '2023-12-18 16:30:00', '2023-12-22 10:00:00'),

('HD-20240105-0011',
 (SELECT id FROM khach_hang WHERE makh = 'KH000010'),
 (SELECT id FROM xe WHERE ma_xe = 'XE000011'),
 (SELECT id FROM ho_so_tham_dinh WHERE mahs = 'HS-20240105-0015'),
 (SELECT id FROM goi_bao_hiem WHERE ma_goi = 'GOI002'),
 '2024-01-05', '2024-01-10', '2025-01-09', 6000000.00, 6000000.00,
 'ACTIVE', 'Hợp đồng mới năm 2024',
 (SELECT id FROM users WHERE username = 'sales'),
 NULL, NULL,
 '2024-01-05 17:00:00', '2024-01-10 09:00:00');

SELECT 'Đã insert ' || COUNT(*) || ' hợp đồng thành công!' as result FROM hop_dong;
