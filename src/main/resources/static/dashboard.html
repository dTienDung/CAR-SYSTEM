<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - H·ªá th·ªëng B·∫£o hi·ªÉm Xe</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">üöó H·ªá th·ªëng B·∫£o hi·ªÉm Xe</div>
        <div class="nav-menu">
            <a href="/dashboard.html" class="nav-link active">Dashboard</a>
            <a href="/users.html" class="nav-link">Ng∆∞·ªùi d√πng</a>
            <a href="/khach-hang.html" class="nav-link">Kh√°ch h√†ng</a>
            <a href="/xe.html" class="nav-link">Xe</a>
            <a href="/goi-bao-hiem.html" class="nav-link">G√≥i BH</a>
            <a href="/ho-so-tham-dinh.html" class="nav-link">H·ªì s∆° TD</a>
            <a href="/hop-dong.html" class="nav-link">H·ª£p ƒë·ªìng</a>
            <a href="/thanh-toan.html" class="nav-link">Thanh to√°n</a>
            <a href="/tieu-chi-tham-dinh.html" class="nav-link">Ti√™u ch√≠ TD</a>
            <a href="/ma-tran-tinh-phi.html" class="nav-link">Ma tr·∫≠n t√≠nh ph√≠</a>
            <a href="/bao-cao.html" class="nav-link">B√°o c√°o</a>
            <span class="nav-user" id="userInfo"></span>
            <button class="btn btn-sm" onclick="logout()">ƒêƒÉng xu·∫•t</button>
        </div>
    </nav>

    <div class="container">
        <h1>üìä Dashboard</h1>
        <div class="stats-grid">
            <div class="stat-card">
                <h3>T·ªïng kh√°ch h√†ng</h3>
                <p class="stat-number" id="totalKhachHang">0</p>
            </div>
            <div class="stat-card">
                <h3>T·ªïng xe</h3>
                <p class="stat-number" id="totalXe">0</p>
            </div>
            <div class="stat-card">
                <h3>H·ª£p ƒë·ªìng ƒëang hi·ªáu l·ª±c</h3>
                <p class="stat-number" id="totalHopDong">0</p>
            </div>
            <div class="stat-card">
                <h3>H·ªì s∆° th·∫©m ƒë·ªãnh</h3>
                <p class="stat-number" id="totalHoSo">0</p>
            </div>
        </div>

        <div class="quick-actions">
            <h2>Thao t√°c nhanh</h2>
            <div class="action-buttons">
                <a href="/khach-hang.html?action=create" class="btn btn-primary">Th√™m kh√°ch h√†ng</a>
                <a href="/xe.html?action=create" class="btn btn-primary">Th√™m xe</a>
                <a href="/ho-so-tham-dinh.html?action=create" class="btn btn-primary">T·∫°o h·ªì s∆° th·∫©m ƒë·ªãnh</a>
                <a href="/hop-dong.html?action=create" class="btn btn-primary">T·∫°o h·ª£p ƒë·ªìng</a>
            </div>
        </div>

        <!-- DASHBOARD CHARTS -->
        <h2 style="margin-top: 40px;">üìà Ph√¢n t√≠ch & B√°o c√°o</h2>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px;">
            <!-- Chart 1: V√≤ng ƒë·ªùi H·ª£p ƒë·ªìng -->
            <div class="chart-container" style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                <h3 style="color: #667eea; margin-bottom: 15px;">üîÑ V√≤ng ƒë·ªùi H·ª£p ƒë·ªìng</h3>
                <canvas id="chart1Lifecycle"></canvas>
            </div>

            <!-- Chart 2: K·∫øt qu·∫£ Th·∫©m ƒë·ªãnh -->
            <div class="chart-container" style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                <h3 style="color: #667eea; margin-bottom: 15px;">‚úÖ K·∫øt qu·∫£ Th·∫©m ƒë·ªãnh</h3>
                <canvas id="chart2Result"></canvas>
            </div>
        </div>

        <!-- Chart 3: Doanh thu Timeline -->
        <div class="chart-container" style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-top: 30px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                <h3 style="color: #667eea; margin: 0;">üí∞ Doanh thu Th·ª±c thu</h3>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <select id="daysSelect" style="padding: 8px; border-radius: 6px; border: 1px solid #ddd;" onchange="handleDateRangeChange()">
                        <option value="7">7 ng√†y</option>
                        <option value="14">14 ng√†y</option>
                        <option value="21" selected>21 ng√†y</option>
                        <option value="custom">T√πy ch·ªânh</option>
                    </select>
                    <div id="customDateRange" style="display: none; gap: 10px; align-items: center;">
                        <label style="font-size: 14px;">T·ª´ ng√†y:</label>
                        <input type="date" id="startDate" style="padding: 8px; border-radius: 6px; border: 1px solid #ddd;">
                        <button class="btn btn-sm btn-primary" onclick="loadChart3DoanhThu()" style="padding: 8px 16px;">√Åp d·ª•ng</button>
                    </div>
                </div>
            </div>
            <canvas id="chart3DoanhThu"></canvas>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px;">
            <!-- Chart 4: T·ª∑ l·ªá T√°i t·ª•c -->
            <div class="chart-container" style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                <h3 style="color: #667eea; margin-bottom: 15px;">üîÅ T·ª∑ l·ªá T√°i t·ª•c</h3>
                <canvas id="chart4TaiTuc"></canvas>
            </div>

            <!-- Chart 5: Top R·ªßi ro -->
            <div class="chart-container" style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                <h3 style="color: #667eea; margin-bottom: 15px;">‚ö†Ô∏è Top Ph∆∞∆°ng ti·ªán R·ªßi ro Cao</h3>
                <canvas id="chart5Risk"></canvas>
            </div>
        </div>
    </div>

    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/role.js"></script>
    <script src="/js/dashboard.js"></script>
</body>
</html>
